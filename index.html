<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌱 Stardew Valley Live Streaming Platform 🌱</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: Arial, sans-serif;
            color: white;
        }
        
        .welcome-container {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
        }
        
        .welcome-title {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .welcome-subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .platform-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .platform-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            color: white;
        }
        
        .btn-streaming {
            background: linear-gradient(135deg, #9C27B0, #E91E63);
        }
        
        .btn-overlay {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }
        
        .btn-setup {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        }
        
        .platform-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .features-list {
            text-align: left;
            margin: 30px 0;
            display: inline-block;
        }
        
        .feature-item {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .version-info {
            margin-top: 30px;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .auto-redirect {
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Twitch - Stardew Valley Garden</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="overlay-container">
        <!-- Cornice principale -->
        <div class="main-frame">
            <!-- Angoli decorativi -->
            <div class="corner top-left">🌱</div>
            <div class="corner top-right">🍄</div>
            <div class="corner bottom-left">🥕</div>
            <div class="corner bottom-right">🌻</div>
            
            <!-- Bordi decorativi -->
            <div class="border-decoration top">
                <span class="plant-icon">🌿</span>
                <span class="plant-icon">🍅</span>
                <span class="plant-icon">🌽</span>
                <span class="plant-icon">🥬</span>
                <span class="plant-icon">🌶️</span>
            </div>
            
            <div class="border-decoration bottom">
                <span class="plant-icon">🥔</span>
                <span class="plant-icon">🍆</span>
                <span class="plant-icon">🥒</span>
                <span class="plant-icon">🌰</span>
                <span class="plant-icon">🍓</span>
            </div>
            
            <div class="border-decoration left">
                <span class="plant-icon vertical">🌸</span>
                <span class="plant-icon vertical">🌺</span>
                <span class="plant-icon vertical">🌼</span>
            </div>
            
            <div class="border-decoration right">
                <span class="plant-icon vertical">🏵️</span>
                <span class="plant-icon vertical">🌷</span>
                <span class="plant-icon vertical">🌹</span>
            </div>
        </div>
        
        <!-- Sezione webcam -->
        <div class="webcam-frame">
            <div class="webcam-border">
                <div class="webcam-title">🧑‍🌾 La Mia Fattoria 🧑‍🌾</div>
            </div>
        </div>
        
        <!-- Pannello informazioni -->
        <div class="info-panel">
            <div class="info-title">📱 Info Giardino 📱</div>
            <div class="info-content">
                <div class="stat-item">
                    <span class="stat-icon">⭐</span>
                    <span class="stat-text">Livello Farming</span>
                    <span class="stat-value" id="farming-level">10</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">💰</span>
                    <span class="stat-text">Monete</span>
                    <span class="stat-value" id="coins">999,999g</span>
                </div>
                <div class="stat-item seeds-item" id="seeds-item">
                    <span class="stat-icon">🌱</span>
                    <span class="stat-text">Semi Piantati</span>
                    <span class="stat-value" id="seeds">42</span>
                    <span class="expand-arrow">▼</span>
                </div>
                
                <!-- Mini box espandibile per i semi -->
                <div class="seeds-box" id="seeds-box">
                    <div class="seeds-box-header">
                        <span class="seeds-title">🌾 I Miei Semi 🌾</span>
                        <span class="seeds-close" id="seeds-close">✕</span>
                    </div>
                    <div class="seeds-grid" id="seeds-grid">
                        <!-- I semi verranno aggiunti dinamicamente dal JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sezione ricette -->
        <div class="recipe-panel">
            <div class="recipe-title" id="recipe-title">👩‍🍳 Ricetta del Giorno 👩‍🍳</div>
            <div class="recipe-content">
                <div class="recipe-item">
                    <span class="recipe-icon" id="recipe-icon">🥗</span>
                    <span class="recipe-name" id="recipe-name">Insalata di Stagione</span>
                </div>
                <div class="recipe-ingredients" id="recipe-ingredients">
                    <span class="ingredient" id="ingredient1">🥬 Lattuga</span>
                    <span class="ingredient" id="ingredient2">🍅 Pomodoro</span>
                    <span class="ingredient" id="ingredient3">🥒 Cetriolo</span>
                </div>
            </div>
        </div>
        
        <!-- Notifiche animate -->
        <div class="notification-area">
            <div class="notification hidden" id="follow-notification">
                <span class="notif-icon">🎉</span>
                <span class="notif-text" id="notification-text">Nuovo Follower!</span>
                <span class="notif-icon">🌟</span>
            </div>
        </div>
        
        <!-- Decorazioni fluttuanti -->
        <div class="floating-decorations">
            <div class="floating-item" style="--delay: 0s; --x: 10%;">🦋</div>
            <div class="floating-item" style="--delay: 2s; --x: 70%;">🐝</div>
            <div class="floating-item" style="--delay: 4s; --x: 40%;">🍃</div>
            <div class="floating-item" style="--delay: 6s; --x: 80%;">✨</div>
            <div class="floating-item" style="--delay: 8s; --x: 20%;">🌸</div>
        </div>
        
        <!-- Barra del tempo -->
        <div class="weather-bar">
            <div class="weather-item">
                <span class="weather-icon" id="weather-icon">☀️</span>
                <span class="weather-text" id="weather-text">Primavera - Giorno 15</span>
            </div>
            <div class="weather-temp" id="weather-temp">22°C</div>
        </div>
    </div>
    
    <script src="main.js"></script>
    <script src="configurator.js"></script>
    <script>
        console.log('🔄 Overlay inizializzato - Modalità URL Parameters + LocalStorage');
        
        // Funzione per ottenere parametri URL
        function getURLParams() {
            const params = new URLSearchParams(window.location.search);
            const data = {};
            
            // Converte tutti i parametri in oggetto
            for (let [key, value] of params) {
                data[key] = value;
            }
            
            return Object.keys(data).length > 0 ? data : null;
        }
        
        // Funzione per caricare i dati salvati (LocalStorage fallback)
        function loadDataFromStorage() {
            return JSON.parse(localStorage.getItem('stardew-overlay-data') || '{}');
        }
        
        // Funzione per aggiornare l'overlay
        function updateOverlay(data) {
            if (data.seeds) document.getElementById('seeds').textContent = data.seeds;
            if (data.coins) document.getElementById('coins').textContent = data.coins;
            if (data.farmingLevel) document.getElementById('farming-level').textContent = data.farmingLevel;
            if (data.weatherIcon) document.getElementById('weather-icon').textContent = data.weatherIcon;
            if (data.weatherText) document.getElementById('weather-text').textContent = data.weatherText;
            if (data.weatherTemp) document.getElementById('weather-temp').textContent = data.weatherTemp;
            if (data.recipeIcon) document.getElementById('recipe-icon').textContent = data.recipeIcon;
            if (data.recipeName) document.getElementById('recipe-name').textContent = data.recipeName;
            if (data.ingredient1) document.getElementById('ingredient1').textContent = data.ingredient1;
            if (data.ingredient2) document.getElementById('ingredient2').textContent = data.ingredient2;
            if (data.ingredient3) document.getElementById('ingredient3').textContent = data.ingredient3;
        }
        
        // Funzione per mostrare notifiche
        function showNotification(message) {
            const notificationElement = document.getElementById('follow-notification');
            const textElement = document.getElementById('notification-text');
            
            if (message) textElement.textContent = message;
            
            notificationElement.classList.remove('hidden');
            setTimeout(() => {
                notificationElement.classList.add('hidden');
            }, 3000);
        }
        
        // Funzione principale per caricare e aggiornare i dati
        function loadOverlayData() {
            // Prova prima i parametri URL (per Streamlabs)
            let data = getURLParams();
            
            // Se non disponibili, usa localStorage (per browser normale)
            if (!data) {
                data = loadDataFromStorage();
            }
            
            // Aggiorna l'overlay
            updateOverlay(data);
            
            console.log('✅ Dati caricati:', data);
            console.log('🔍 Modalità:', data && Object.keys(data).length > 0 ? 'URL Parameters (Streamlabs)' : 'LocalStorage (Browser)');
        }
        
        // Controlla le notifiche separatamente (sempre da localStorage)
        function checkNotifications() {
            const notificationData = localStorage.getItem('stardew-overlay-notification');
            if (notificationData) {
                const notification = JSON.parse(notificationData);
                showNotification(notification.message);
                localStorage.removeItem('stardew-overlay-notification');
            }
        }
        
        // Per browser normale: controlla aggiornamenti ogni 2 secondi
        if (!getURLParams()) {
            setInterval(() => {
                loadOverlayData();
                checkNotifications();
            }, 2000);
        }
        
        // Per Streamlabs: controlla solo notifiche
        if (getURLParams()) {
            setInterval(checkNotifications, 2000);
        }
        
        // Carica i dati all'avvio
        loadOverlayData();
        checkNotifications();
    </script>
    
    <!-- Welcome Screen Overlay -->
    <div class="welcome-screen">
        <div class="welcome-container">
            <div class="welcome-title">
                🎮 Stardew Valley<br>Live Streaming Platform
            </div>
            
            <div class="welcome-subtitle">
                Overlay personalizzato + Streaming diretto con le tue API
            </div>
            
            <div class="features-list">
                <div class="feature-item">🔴 <strong>Streaming Live</strong> - Twitch + TikTok simultaneo</div>
                <div class="feature-item">🎨 <strong>Overlay Animato</strong> - Tema Stardew Valley</div>
                <div class="feature-item">📊 <strong>Statistiche Real-time</strong> - Spettatori live</div>
                <div class="feature-item">🎛️ <strong>Controllo Totale</strong> - Le tue API, il tuo controllo</div>
                <div class="feature-item">🆓 <strong>100% Gratuito</strong> - Deploy su Render.com</div>
            </div>
            
            <div class="platform-options">
                <a href="/setup-streaming.html" class="platform-btn btn-setup">
                    ⚙️ Setup API
                </a>
                <a href="/live-client.html" class="platform-btn btn-streaming">
                    🔴 Live Platform
                </a>
                <a href="/controllo.html" class="platform-btn btn-overlay">
                    🎛️ Controller
                </a>
            </div>
            
            <div class="version-info">
                🌱 Stardew Live Platform v3.0 - Client-Side OAuth<br>
                🔐 Le tue API restano nel tuo browser (sicurezza massima)
            </div>
            
            <div class="auto-redirect">
                ⏰ Auto-redirect tra <span id="countdown">8</span> secondi...
            </div>
        </div>
    </div>
    
    <script>
        console.log('🌱 Welcome Screen inizializzata');
        
        // Controlla configurazione esistente
        const config = localStorage.getItem('streaming_config');
        let targetUrl = '/setup-streaming.html';
        let countdownTime = 8;
        
        if (config) {
            const parsed = JSON.parse(config);
            if (parsed.configured) {
                targetUrl = '/live-client.html';
                document.querySelector('.auto-redirect').innerHTML = '⏰ Vai alla piattaforma tra <span id="countdown">5</span> secondi...';
                countdownTime = 5;
            }
        }
        
        // Countdown automatico
        let countdown = countdownTime;
        const countdownElement = document.getElementById('countdown');
        
        const timer = setInterval(() => {
            countdown--;
            if (countdownElement) {
                countdownElement.textContent = countdown;
            }
            
            if (countdown <= 0) {
                clearInterval(timer);
                window.location.href = targetUrl;
            }
        }, 1000);
        
        // Click annulla countdown
        document.querySelector('.welcome-screen').addEventListener('click', () => {
            clearInterval(timer);
            document.querySelector('.auto-redirect').textContent = '✋ Auto-redirect disabilitato - Scegli tu';
        });
    </script>
</body>
</html>